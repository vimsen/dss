<%= javascript_include_tag "chart" %>

<% startDate = (DateTime.now - 7.days)
   endDate = DateTime.now 
 %>

<div>
  <div id="placeholder" style="width:100%;height:400px;min-width=600px"></div>
  <div id="controls">
    <input id="startDate" type="text" value="<%= startDate %>"/>
    <input id="endDate" type="text" value="<%= endDate %>"/> <br/>
    <strong>Real-time updates?</strong>
    <input id="realtime" type="checkbox" checked>
    <button id="subDates"> Set </button>
    <br/>
  </div>
</div>
<script>  
   
    var idata = <%= provider.request_cached(3, startDate, endDate).to_json.html_safe %>;
    
    
    console.log(idata);

    $(function(){
        plotHelper.drawChart("<%= stream %>", plotHelper.readData(idata));
        $('#startDate').datetimepicker();
        $('#endDate').datetimepicker();
        $('#endDate').prop('disabled', true);
        $('#subDates').click(function () {
            var s = $('#startDate').val();
            var e = $('#endDate').prop("disabled") ? '' : $('#endDate').val();
            var params= '';
            if (s || e ) {
              params += '?';
            } 
            if (s) {
              params += 'startdate=' + s;
              if (e) {
                params += '&';
              }
            }
            if (e) {
              params += 'enddate=' + e
            }
            plotHelper.drawChart("<%= stream %>" + params, {});
        });
        $('#realtime').change(function () {
            console.log(this.checked);
            if (this.checked) {
              $('#endDate').prop( "disabled", true );
            } else {
              $('#endDate').prop( "disabled", false );
            }
        });
    });
</script>

